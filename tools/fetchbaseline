hostname=$1
port=$2
username="wangyi"
echo "hostname=$hostname, port=$port"

while read line
do
    arr[i]=$line
    i=$(($i+1))
done < $GOPATH/vpcm/project_list.scm

for((i=0;i<${#arr[@]};i++))
do
    line=${arr[$i]}
    projectname=`echo $line | awk '{ print $1; }'`
    address=`echo $line | awk '{ print $2; }'`
    need_included_baseline=`echo $line | awk '{ print $3; }'`
    need_publish=`echo $line | awk '{ print $4; }'`
    
    if [ "$projectname" == "" ]; then
        continue
    fi
    if [ "$need_included_baseline" != "yes" ]; then
        continue
    fi
    if [ "$need_publish" != "yes" ]; then  
        continue
    fi
    if [ -f $GOPATH/vpcm/project/$projectname/publish/$projectname.serviceroot ]; then
        project_dest=`cat $GOPATH/vpcm/project/$projectname/publish/$projectname.serviceroot`
    else
        continue
    fi
    
    echo -e "$projectname/\c"
    ssh -p $port -q $username@$hostname "if [ -f $project_dest/$projectname/src/version.txt ]; then cat $project_dest/$projectname/src/version.txt; else cat $project_dest/$projectname/version.txt; fi"
    echo
done